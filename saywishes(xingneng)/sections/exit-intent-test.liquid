<style>
  .exit-intent-test {
    max-width: 800px;
    margin: 2rem auto;
    padding: 2rem;
    background: #f8f9fa;
    border-radius: 12px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }

  .test-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .test-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 0.5rem;
  }

  .test-subtitle {
    font-size: 1.1rem;
    color: #718096;
    margin-bottom: 1rem;
  }

  .trigger-methods {
    display: grid;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .trigger-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-left: 4px solid #4299e1;
  }

  .trigger-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .trigger-description {
    color: #4a5568;
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .trigger-demo {
    background: #edf2f7;
    padding: 1rem;
    border-radius: 6px;
    font-size: 0.9rem;
    color: #2d3748;
  }

  .status-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 0.5rem;
  }

  .status-active {
    background: #48bb78;
    animation: pulse 2s infinite;
  }

  .status-inactive {
    background: #cbd5e0;
  }

  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
  }

  .test-controls {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
  }

  .control-button {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    margin-right: 1rem;
    margin-bottom: 0.5rem;
    transition: transform 0.2s;
  }

  .control-button:hover {
    transform: translateY(-2px);
  }

  .control-button.reset {
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
  }

  .event-log {
    background: #1a202c;
    color: #e2e8f0;
    padding: 1rem;
    border-radius: 6px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    max-height: 200px;
    overflow-y: auto;
    margin-top: 1rem;
  }

  .log-entry {
    margin-bottom: 0.25rem;
    padding: 0.25rem 0;
  }

  .log-timestamp {
    color: #68d391;
  }

  .log-event {
    color: #90cdf4;
  }

  .log-details {
    color: #fbb6ce;
  }

  .warning-box {
    background: #fed7d7;
    border: 1px solid #feb2b2;
    color: #c53030;
    padding: 1rem;
    border-radius: 6px;
    margin-bottom: 1rem;
  }

  .info-box {
    background: #bee3f8;
    border: 1px solid #90cdf4;
    color: #2b6cb0;
    padding: 1rem;
    border-radius: 6px;
    margin-bottom: 1rem;
  }
</style>

<div class="exit-intent-test">
  <div class="test-header">
    <h1 class="test-title">ğŸ¯ é€€å‡ºæ„å›¾æ£€æµ‹æµ‹è¯•</h1>
    <p class="test-subtitle">å®æ—¶ç›‘æ§é€€å‡ºæ„å›¾è§¦å‘æ¡ä»¶</p>
  </div>

  <div class="warning-box">
    <strong>âš ï¸ æ³¨æ„ï¼š</strong>ä¸ºäº†æµ‹è¯•ç›®çš„ï¼Œæ­¤é¡µé¢ä¼šæ˜¾ç¤ºé€€å‡ºæ„å›¾å¼¹çª—çš„è§¦å‘æƒ…å†µã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¼¹çª—åªä¼šåœ¨å®¢æˆ·çœŸæ­£å‡†å¤‡ç¦»å¼€æ—¶æ˜¾ç¤ºã€‚
  </div>

  <div class="info-box">
    <strong>ğŸ’¡ æç¤ºï¼š</strong>é€€å‡ºæ„å›¾å¼¹çª—å·²ä¼˜åŒ–ä¸ºåªåœ¨çœŸå®é€€å‡ºè¡Œä¸ºæ—¶è§¦å‘ï¼Œé¿å…å¹²æ‰°æ­£å¸¸æµè§ˆä½“éªŒã€‚
  </div>

  <div class="trigger-methods">
    <div class="trigger-card">
      <h3 class="trigger-title">
        <span class="status-indicator" id="mouseStatus"></span>
        ğŸ–±ï¸ é¼ æ ‡é€€å‡ºæ£€æµ‹
      </h3>
      <p class="trigger-description">
        å½“ç”¨æˆ·å°†é¼ æ ‡ç§»å‡ºæµè§ˆå™¨çª—å£é¡¶éƒ¨æ—¶è§¦å‘ã€‚è¿™æ˜¯æœ€å¸¸è§çš„é€€å‡ºæ„å›¾ä¿¡å·ã€‚
      </p>
      <div class="trigger-demo">
        <strong>æµ‹è¯•æ–¹æ³•ï¼š</strong>å°†é¼ æ ‡å¿«é€Ÿç§»åŠ¨åˆ°æµè§ˆå™¨çª—å£é¡¶éƒ¨è¾¹ç¼˜å¤–
      </div>
    </div>

    <div class="trigger-card">
      <h3 class="trigger-title">
        <span class="status-indicator" id="keyboardStatus"></span>
        âŒ¨ï¸ é”®ç›˜å¿«æ·é”®æ£€æµ‹
      </h3>
      <p class="trigger-description">
        æ£€æµ‹å¸¸ç”¨çš„å…³é—­é¡µé¢å¿«æ·é”®ï¼šAlt+F4ï¼ˆå…³é—­çª—å£ï¼‰ã€Ctrl+Wï¼ˆå…³é—­æ ‡ç­¾é¡µï¼‰ã€‚
      </p>
      <div class="trigger-demo">
        <strong>æµ‹è¯•æ–¹æ³•ï¼š</strong>æŒ‰ä¸‹ Ctrl+W æˆ– Alt+F4ï¼ˆæ³¨æ„ï¼šå®é™…ä¼šå°è¯•å…³é—­é¡µé¢ï¼‰
      </div>
    </div>

    <div class="trigger-card">
      <h3 class="trigger-title">
        <span class="status-indicator" id="scrollStatus"></span>
        ğŸ“± ç§»åŠ¨ç«¯æ»šåŠ¨æ£€æµ‹
      </h3>
      <p class="trigger-description">
        åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œæ£€æµ‹ç”¨æˆ·è¿ç»­å‘ä¸Šæ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨çš„è¡Œä¸ºï¼Œè¿™é€šå¸¸è¡¨ç¤ºæƒ³è¦ç¦»å¼€ã€‚
      </p>
      <div class="trigger-demo">
        <strong>æµ‹è¯•æ–¹æ³•ï¼š</strong>åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¿«é€Ÿè¿ç»­å‘ä¸Šæ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
      </div>
    </div>

    <div class="trigger-card">
      <h3 class="trigger-title">
        <span class="status-indicator" id="timeStatus"></span>
        â° æ—¶é—´è§¦å‘å™¨ï¼ˆå·²ç¦ç”¨ï¼‰
      </h3>
      <p class="trigger-description">
        åŸæœ¬çš„3åˆ†é’Ÿè‡ªåŠ¨è§¦å‘å·²è¢«ç¦ç”¨ï¼Œé¿å…å¹²æ‰°ç”¨æˆ·æ­£å¸¸æµè§ˆã€‚åªæœ‰åœ¨åå°æ‰‹åŠ¨å¯ç”¨æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚
      </p>
      <div class="trigger-demo">
        <strong>çŠ¶æ€ï¼š</strong>é»˜è®¤ç¦ç”¨ï¼Œæ¨èä¿æŒç¦ç”¨çŠ¶æ€ä»¥æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
      </div>
    </div>
  </div>

  <div class="test-controls">
    <h3>ğŸ”§ æµ‹è¯•æ§åˆ¶</h3>
    <button class="control-button" onclick="simulateMouseExit()">æ¨¡æ‹Ÿé¼ æ ‡é€€å‡º</button>
    <button class="control-button" onclick="simulateKeyboardExit()">æ¨¡æ‹Ÿé”®ç›˜é€€å‡º</button>
    <button class="control-button" onclick="simulateMobileScroll()">æ¨¡æ‹Ÿç§»åŠ¨æ»šåŠ¨</button>
    <button class="control-button reset" onclick="resetTest()">é‡ç½®æµ‹è¯•</button>
    
    <div class="event-log" id="eventLog">
      <div class="log-entry">
        <span class="log-timestamp">[ç³»ç»Ÿ]</span> 
        <span class="log-event">é€€å‡ºæ„å›¾æ£€æµ‹ç³»ç»Ÿå·²å¯åŠ¨</span>
      </div>
    </div>
  </div>
</div>

<script>
  class ExitIntentTester {
    constructor() {
      this.eventLog = document.getElementById('eventLog');
      this.mouseStatus = document.getElementById('mouseStatus');
      this.keyboardStatus = document.getElementById('keyboardStatus');
      this.scrollStatus = document.getElementById('scrollStatus');
      this.timeStatus = document.getElementById('timeStatus');
      
      this.init();
    }

    init() {
      this.updateStatusIndicators();
      this.bindEvents();
      this.logEvent('ç³»ç»Ÿ', 'å¼€å§‹ç›‘æ§é€€å‡ºæ„å›¾è¡Œä¸º');
    }

    updateStatusIndicators() {
      // é¼ æ ‡æ£€æµ‹å§‹ç»ˆæ´»è·ƒ
      this.mouseStatus.className = 'status-indicator status-active';
      
      // é”®ç›˜æ£€æµ‹å§‹ç»ˆæ´»è·ƒ
      this.keyboardStatus.className = 'status-indicator status-active';
      
      // ç§»åŠ¨ç«¯æ»šåŠ¨æ£€æµ‹ï¼ˆæ ¹æ®è®¾å¤‡ç±»å‹ï¼‰
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      this.scrollStatus.className = `status-indicator ${isMobile ? 'status-active' : 'status-inactive'}`;
      
      // æ—¶é—´è§¦å‘å™¨ï¼ˆå·²ç¦ç”¨ï¼‰
      this.timeStatus.className = 'status-indicator status-inactive';
    }

    bindEvents() {
      // é¼ æ ‡ç¦»å¼€æ£€æµ‹
      document.addEventListener('mouseleave', (e) => {
        if (e.clientY <= 0) {
          this.logEvent('é¼ æ ‡', `æ£€æµ‹åˆ°é¼ æ ‡ç¦»å¼€çª—å£é¡¶éƒ¨ (Y: ${e.clientY})`, 'è¿™ä¼šè§¦å‘é€€å‡ºæ„å›¾å¼¹çª—');
        }
      });

      // é”®ç›˜äº‹ä»¶æ£€æµ‹
      document.addEventListener('keydown', (e) => {
        if ((e.altKey && e.key === 'F4') || 
            (e.ctrlKey && (e.key === 'w' || e.key === 'W'))) {
          this.logEvent('é”®ç›˜', `æ£€æµ‹åˆ°é€€å‡ºå¿«æ·é”®: ${e.ctrlKey ? 'Ctrl+' : ''}${e.altKey ? 'Alt+' : ''}${e.key}`, 'è¿™ä¼šè§¦å‘é€€å‡ºæ„å›¾å¼¹çª—');
        }
      });

      // æ»šåŠ¨äº‹ä»¶æ£€æµ‹ï¼ˆç§»åŠ¨ç«¯ï¼‰
      let lastScrollTop = 0;
      let scrollUpCount = 0;
      
      window.addEventListener('scroll', () => {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        
        if (scrollTop < lastScrollTop) {
          scrollUpCount++;
          
          if (scrollUpCount > 3 && scrollTop < 100) {
            this.logEvent('æ»šåŠ¨', `æ£€æµ‹åˆ°è¿ç»­å‘ä¸Šæ»šåŠ¨ (æ¬¡æ•°: ${scrollUpCount}, ä½ç½®: ${scrollTop}px)`, 'è¿™ä¼šåœ¨ç§»åŠ¨ç«¯è§¦å‘é€€å‡ºæ„å›¾å¼¹çª—');
          }
        } else {
          scrollUpCount = 0;
        }
        
        lastScrollTop = scrollTop;
      });
    }

    logEvent(source, event, details = '') {
      const timestamp = new Date().toLocaleTimeString('en-US');
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';
      logEntry.innerHTML = `
        <span class="log-timestamp">[${timestamp}]</span> 
        <span class="log-event">${source}: ${event}</span>
        ${details ? `<br><span class="log-details">â†’ ${details}</span>` : ''}
      `;
      
      this.eventLog.appendChild(logEntry);
      this.eventLog.scrollTop = this.eventLog.scrollHeight;
    }

    simulateMouseExit() {
      this.logEvent('æ¨¡æ‹Ÿ', 'æ‰‹åŠ¨è§¦å‘é¼ æ ‡é€€å‡ºäº‹ä»¶', 'åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¿™ä¼šæ˜¾ç¤ºé€€å‡ºæ„å›¾å¼¹çª—');
    }

    simulateKeyboardExit() {
      this.logEvent('æ¨¡æ‹Ÿ', 'æ‰‹åŠ¨è§¦å‘é”®ç›˜é€€å‡ºäº‹ä»¶ (Ctrl+W)', 'åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œè¿™ä¼šæ˜¾ç¤ºé€€å‡ºæ„å›¾å¼¹çª—');
    }

    simulateMobileScroll() {
      this.logEvent('æ¨¡æ‹Ÿ', 'æ‰‹åŠ¨è§¦å‘ç§»åŠ¨ç«¯æ»šåŠ¨é€€å‡ºäº‹ä»¶', 'åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šï¼Œè¿™ä¼šæ˜¾ç¤ºé€€å‡ºæ„å›¾å¼¹çª—');
    }

    reset() {
      this.eventLog.innerHTML = `
        <div class="log-entry">
          <span class="log-timestamp">[ç³»ç»Ÿ]</span> 
          <span class="log-event">æµ‹è¯•å·²é‡ç½®ï¼Œé‡æ–°å¼€å§‹ç›‘æ§</span>
        </div>
      `;
      this.logEvent('ç³»ç»Ÿ', 'é€€å‡ºæ„å›¾æ£€æµ‹ç³»ç»Ÿå·²é‡å¯');
    }
  }

  // å…¨å±€å‡½æ•°
  function simulateMouseExit() {
    if (window.exitIntentTester) {
      window.exitIntentTester.simulateMouseExit();
    }
  }

  function simulateKeyboardExit() {
    if (window.exitIntentTester) {
      window.exitIntentTester.simulateKeyboardExit();
    }
  }

  function simulateMobileScroll() {
    if (window.exitIntentTester) {
      window.exitIntentTester.simulateMobileScroll();
    }
  }

  function resetTest() {
    if (window.exitIntentTester) {
      window.exitIntentTester.reset();
    }
  }

  // åˆå§‹åŒ–æµ‹è¯•å™¨
  document.addEventListener('DOMContentLoaded', function() {
    window.exitIntentTester = new ExitIntentTester();
  });
</script>

{% schema %}
{
  "name": "Exit Intent Test",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Test Settings"
    },
    {
      "type": "checkbox",
      "id": "show_test",
      "label": "Show Exit Intent Test",
      "default": true,
      "info": "Display the exit intent detection test page"
    }
  ],
  "presets": [
    {
      "name": "Exit Intent Test"
    }
  ]
}
{% endschema %}