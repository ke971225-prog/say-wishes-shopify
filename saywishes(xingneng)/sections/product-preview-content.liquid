{% comment %}
  Renders product preview content for modal - Optimized for Quick View

  Accepts:
  - product: {Object} Product object
  - variant: {Object} Variant object
  - quantity: {Number} Quantity added to cart

  Usage:
  {% render 'product-preview-content', product: product, variant: variant, quantity: quantity %}
{% endcomment %}

{%- if product -%}
  <div class="product-preview-item" data-product-id="{{ product.id }}" data-variant-id="{{ variant.id }}">
    <div class="product-preview-item__media">
      {%- if product.media.size > 0 -%}
        <div class="product-preview-item__gallery">
          {%- assign featured_media = variant.featured_media | default: product.featured_media -%}
          
          {%- if featured_media -%}
            <div class="product-preview-item__main-image">
              {%- if featured_media.media_type == 'image' -%}
                <img
                  src="{{ featured_media | image_url: width: 400 }}"
                  alt="{{ featured_media.alt | escape }}"
                  width="200"
                  height="{{ 200 | divided_by: featured_media.aspect_ratio | ceil }}"
                  loading="lazy"
                  class="product-preview-main-img"
                >
              {%- elsif featured_media.media_type == 'video' -%}
                {{ featured_media | video_tag: image_size: "400x", loop: true, controls: true, muted: true }}
              {%- endif -%}
            </div>
          {%- endif -%}
          
          {%- if product.media.size > 1 -%}
            <div class="product-preview-item__thumbnails">
              {%- for media in product.media limit: 4 -%}
                {%- if media.media_type == 'image' -%}
                  <button 
                    type="button" 
                    class="product-preview-thumbnail{% if media.id == featured_media.id %} active{% endif %}"
                    data-media-id="{{ media.id }}"
                    onclick="switchPreviewImage('{{ media | image_url: width: 400 }}', '{{ media.alt | escape }}')"
                  >
                    <img
                      src="{{ media | image_url: width: 80 }}"
                      alt="{{ media.alt | escape }}"
                      width="40"
                      height="40"
                      loading="lazy"
                    >
                  </button>
                {%- endif -%}
              {%- endfor -%}
            </div>
          {%- endif -%}
        </div>
      {%- elsif variant.featured_image -%}
        <div class="product-preview-item__image global-media-settings">
          <img
            src="{{ variant.featured_image | image_url: width: 400 }}"
            alt="{{ variant.featured_image.alt | escape }}"
            width="200"
            height="{{ 200 | divided_by: variant.featured_image.aspect_ratio | ceil }}"
            loading="lazy"
          >
        </div>
      {%- elsif product.featured_image -%}
        <div class="product-preview-item__image global-media-settings">
          <img
            src="{{ product.featured_image | image_url: width: 400 }}"
            alt="{{ product.featured_image.alt | escape }}"
            width="200"
            height="{{ 200 | divided_by: product.featured_image.aspect_ratio | ceil }}"
            loading="lazy"
          >
        </div>
      {%- endif -%}
    </div>
    
    <div class="product-preview-item__details">
      {%- if settings.show_vendor -%}
        <p class="product-preview-item__vendor caption-with-letter-spacing light">{{ product.vendor }}</p>
      {%- endif -%}
      
      <h3 class="product-preview-item__title h4">{{ product.title | escape }}</h3>
      
      {%- if product.description != blank -%}
        <div class="product-preview-item__description">
          <p class="product-preview-description">
            {{ product.description | strip_html | truncate: 120, '...' }}
          </p>
        </div>
      {%- endif -%}
      
      <div class="product-preview-item__variant-info">
        {%- unless product.has_only_default_variant -%}
          {%- for option in variant.options -%}
            {%- assign option_name = product.options[forloop.index0] -%}
            <div class="product-option">
              <dt>{{ option_name }}:</dt>
              <dd>{{ option }}</dd>
            </div>
          {%- endfor -%}
        {%- endunless -%}
      </div>
      
      <div class="product-preview-item__price">
        {%- if variant.compare_at_price > variant.price -%}
          <dl class="product-preview-item__discounted-prices">
            <dt class="visually-hidden">
              {{ 'products.product.price.sale_price' | t }}
            </dt>
            <dd class="price price--on-sale">
              {{ variant.price | money }}
            </dd>
            <dt class="visually-hidden">
              {{ 'products.product.price.regular_price' | t }}
            </dt>
            <dd>
              <s class="price price--compare">
                {{ variant.compare_at_price | money }}
              </s>
            </dd>
          </dl>
        {%- else -%}
          <span class="price">
            {{ variant.price | money }}
          </span>
        {%- endif -%}
      </div>
      
      <div class="product-preview-item__quantity">
        <span class="product-preview-item__quantity-label">{{ 'products.product.quantity.label' | t }}:</span>
        <span class="product-preview-item__quantity-value">{{ quantity | default: 1 }}</span>
      </div>
      
      <div class="product-preview-item__actions">
        <a href="/cart" class="button button--tertiary">
          View full details
        </a>
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "产品预览内容",
  "settings": []
}
{% endschema %}