/* 购物车数量控制统一样式 */
/* 基于Shopify官方最佳实践和响应式设计原则 */
/* 解决移动端和桌面端数量控制冲突问题 */

/* =================================
   基础数量控制样式
   ================================= */

/* 数量控制容器 */
.cart-item__quantity {
  position: relative;
}

.cart-item__quantity .quantity-popover-container {
  display: flex;
  align-items: center;
  gap: 0;
  position: relative;
}

/* quantity-input 组件基础样式 */
.cart-item__quantity quantity-input {
  display: flex;
  align-items: center;
  position: relative;
}

/* =================================
   桌面端样式 (>= 750px)
   ================================= */

@media screen and (min-width: 750px) {
  /* 桌面端显示完整的数量控制 */
  .cart-item__quantity .quantity__button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 35px;
    height: 35px;
    min-width: 35px;
    min-height: 35px;
    border: 1px solid rgba(var(--color-foreground), 0.2);
    background: rgb(var(--color-background));
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
  }
  
  .cart-item__quantity .quantity__button:hover {
    background: rgba(var(--color-foreground), 0.05);
    border-color: rgba(var(--color-foreground), 0.3);
  }
  
  .cart-item__quantity .quantity__button:active {
    background: rgba(var(--color-foreground), 0.1);
  }
  
  .cart-item__quantity .quantity__button.disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }
  
  .cart-item__quantity .quantity__input {
    width: 50px;
    height: 35px;
    text-align: center;
    border: 1px solid rgba(var(--color-foreground), 0.2);
    border-left: none;
    border-right: none;
    background: rgb(var(--color-background));
    font-size: 14px;
    line-height: 1;
    padding: 0;
    margin: 0;
  }
  
  .cart-item__quantity .quantity__button svg {
    width: 12px;
    height: 12px;
    fill: currentColor;
  }

  /* 覆盖：数量与移除垂直堆叠居中，确保视觉比例优化但不改变信息 */
  .cart-items .cart-item > td.cart-item__quantity .quantity-popover-container {
    flex-direction: column;
    align-items: center;
    gap: clamp(6px, 1.2vw, 12px);
  }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button {
    margin-top: clamp(6px, 1.2vw, 12px);
  }
}

/* =================================
   移动端样式 (< 750px)
   ================================= */

@media screen and (max-width: 749px) {
  /* 移动端显示增减按钮，保持一致性 */
  .cart-item__quantity .quantity__button[name="minus"],
  .cart-item__quantity .quantity__button[name="plus"] {
    display: flex;
    width: 32px;
    height: 32px;
    min-width: 32px;
    min-height: 32px;
  }
  
  .cart-item__quantity quantity-input {
    justify-content: center;
  }
  
  .cart-item__quantity .quantity__input {
    width: 50px;
    height: 32px;
    font-size: 14px;
    text-align: center;
    border: 1px solid rgba(var(--color-foreground), 0.2);
    border-radius: 4px;
    background: rgb(var(--color-background));
    padding: 0;
    margin: 0;
  }
  
  /* 移动端购物车表格优化 */
  .cart-items {
    width: 100%;
    table-layout: fixed;
    border-collapse: collapse;
  }
  
  .cart-items th,
  .cart-items td {
    padding: 0.5rem 0.25rem;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }
  
  /* 列宽分配 */
  .cart-item__media {
    width: 20%;
    min-width: 60px;
  }
  
  .cart-item__details {
    width: 45%;
    padding-right: 0.5rem;
  }
  
  .cart-item__quantity {
    width: 25%;
    text-align: center;
  }
  
  .cart-item__totals {
    width: 10%;
    text-align: right;
  }
  
  /* 商品图片优化 */
  .cart-item__image {
    max-width: 100%;
    height: auto;
    object-fit: cover;
  }
  
  /* 商品标题优化 */
  .cart-item__name {
    font-size: 0.9rem;
    line-height: 1.2;
    margin-bottom: 0.25rem;
  }
  
  /* 产品选项显示 */
  .product-option {
    font-size: 0.8rem;
    margin-bottom: 0.125rem;
    color: rgba(var(--color-foreground), 0.7);
  }

  .cart-item__price-wrapper {
    font-size: 0.85rem;
  }
  
  /* 追加：数量与移除采用黄金比例两列，行内总价第二行占满右对齐；不改变信息，仅优化呈现 */
  .cart-items .cart-item > td.cart-item__quantity {
    position: relative;
  }
  .cart-items .cart-item > td.cart-item__quantity .quantity-popover-container {
    display: grid;
    grid-template-columns: minmax(0, 0.618fr) minmax(36px, 0.382fr);
    align-items: center;
    column-gap: clamp(6px, 2vw, 12px);
    row-gap: clamp(6px, 2vw, 12px);
  }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button { justify-self: end; }
  .cart-items .cart-item > td.cart-item__quantity .cart-item__total-inline { grid-column: 1 / -1; justify-self: end; text-align: right; }
  
  /* 产品选项单列显示，长链接断行（仅视觉换行） */
  .cart-item__details dl { display: grid; gap: 4px; }
  .cart-item__details dl .product-option dt,
  .cart-item__details dl .product-option dd { display: block; margin: 0; padding: 0; }
  .cart-item__details .product-option .link { word-break: break-all; overflow-wrap: anywhere; }
  
  /* 隐藏原有移动端独立总价列，改用行内总价显示 */
  .cart-items .cart-item > td.cart-item__totals.cart-item__totals--mobile {
    display: none !important;
  }
}

/* =================================
   超小屏幕优化 (< 480px)
   ================================= */

@media screen and (max-width: 479px) {
  .cart-items th,
  .cart-items td {
    padding: 0.25rem 0.125rem;
  }
  
  .cart-item__media {
    width: 18%;
  }
  
  .cart-item__details {
    width: 47%;
  }
  
  .cart-item__quantity {
    width: 25%;
  }
  
  .cart-item__totals {
    width: 10%;
  }
  
  .cart-item__name {
    font-size: 0.8rem;
  }
  
  .product-option {
    font-size: 0.7rem;
  }
  
  .cart-item__quantity .quantity__input {
    width: 45px;
    height: 28px;
    font-size: 12px;
  }

  /* 保持黄金比例两列，适配更小按钮尺寸 */
  .cart-items .cart-item > td.cart-item__quantity .quantity-popover-container {
    grid-template-columns: minmax(0, 0.618fr) minmax(32px, 0.382fr);
    column-gap: clamp(6px, 3vw, 12px);
  }
}

/* =================================
   删除按钮样式
   ================================= */

cart-remove-button {
  display: block;
}

cart-remove-button .button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  min-width: 40px;
  min-height: 40px;
  border: 1px solid rgba(var(--color-foreground), 0.2);
  border-radius: 4px;
  background-color: transparent;
  color: rgb(var(--color-foreground));
  transition: all 0.2s ease;
  cursor: pointer;
}

cart-remove-button .button:hover {
  background-color: rgba(var(--color-base-accent-1), 0.1);
  border-color: rgb(var(--color-base-accent-1));
  color: rgb(var(--color-base-accent-1));
}

cart-remove-button .svg-wrapper {
  width: 38px;
  height: 38px;
}

@media screen and (max-width: 749px) {
  cart-remove-button .button {
    width: 38px;
    height: 38px;
    min-width: 38px;
    min-height: 38px;
  }
  
  cart-remove-button .svg-wrapper {
    width: 36px;
    height: 36px;
  }
}

@media screen and (max-width: 479px) {
  cart-remove-button .button {
    width: 36px;
    height: 36px;
    min-width: 36px;
    min-height: 36px;
  }
  
  cart-remove-button .svg-wrapper {
    width: 34px;
    height: 34px;
  }
}

/* =================================
   价格显示优化
   ================================= */

.cart-item__price-wrapper {
  font-size: 0.9rem;
}

.price {
  font-weight: 600;
}

/* 行分隔线与对齐优化（购物车页面） */
.cart-items tbody td {
  border-bottom: 0.1rem solid rgba(var(--color-foreground), 0.08);
}
.cart-items tbody tr:last-child td {
  border-bottom: 0;
}
.cart-items .cart-item > td.cart-item__quantity {
  vertical-align: middle;
}

@media screen and (max-width: 749px) {
  .cart-item__price-wrapper {
    font-size: 0.85rem;
  }
  
  /* 调整栅格列兼容性 */
  .cart-items .cart-item > td.cart-item__quantity .quantity__button { width: 36px; height: 36px; }
  .cart-items .cart-item > td.cart-item__quantity .quantity__input { height: 36px; min-width: 64px; text-align: center; }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .button { width: 36px; height: 36px; padding: 0; border: 1px solid rgba(var(--color-foreground), 0.15); border-radius: 8px; display: inline-flex; align-items: center; justify-content: center; }
  .cart-items .cart-item > td.cart-item__quantity .cart-item__total-inline { min-width: 0; }
}

@media screen and (max-width: 479px) {
  .cart-items .cart-item > td.cart-item__quantity .quantity-popover-container { gap: 0.375rem; }
  .cart-items .cart-item > td.cart-item__quantity .quantity__button { width: 32px; height: 32px; }
  .cart-items .cart-item > td.cart-item__quantity .quantity__input { height: 32px; min-width: 56px; text-align: center; }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .button { width: 32px; height: 32px; padding: 0; }
}

/* 桌面端数量与价格统一对齐与尺寸 */
@media screen and (min-width: 750px) {
  .cart-items .cart-item > td.cart-item__totals { text-align: right; }
  .cart-items .cart-item > td.cart-item__totals .price { font-weight: 600; }
  .cart-items .cart-item > td.cart-item__quantity .quantity__button { width: 34px; height: 34px; }
  .cart-items .cart-item > td.cart-item__quantity .quantity__input { height: 34px; min-width: 60px; }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .button { width: 34px; height: 34px; }
}

/* 修复删除按钮图标显示：确保SVG可见且自适应包裹尺寸 */
.cart-items .cart-item > td.cart-item__quantity cart-remove-button .svg-wrapper { width: 20px; height: 20px; display: inline-block; }
.cart-items .cart-item > td.cart-item__quantity cart-remove-button .svg-wrapper svg { width: 100%; height: 100%; display: block; }

/* =================================
   确保基础功能可用
   ================================= */

.quantity__input {
  -webkit-appearance: none;
  -moz-appearance: textfield;
}

.quantity__input::-webkit-outer-spin-button,
.quantity__input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* 确保所有必要元素可见 */
.cart-item__quantity,
.cart-item__quantity .quantity-popover-container,
.cart-item__quantity quantity-input,
.cart-item__quantity .quantity__input,
cart-remove-button,
cart-remove-button .button {
  visibility: visible;
  opacity: 1;
  pointer-events: auto;
}

@media screen and (max-width: 749px) {
  .cart-items .cart-item > td.cart-item__quantity .cart-item__total-inline .price {
    font-weight: 700;
  }
}

/* ================================
   同步尺寸到本地原型（覆盖规则）
   ================================ */
@media screen and (min-width: 750px) {
  /* 桌面端数量按钮 40x40，输入框 40 高，图标 16x16 */
  .cart-items .cart-item > td.cart-item__quantity .quantity__button,
  .cart-item__quantity .quantity__button { width: 40px; height: 40px; min-width: 40px; min-height: 40px; }
  .cart-items .cart-item > td.cart-item__quantity .quantity__input,
  .cart-item__quantity .quantity__input { height: 40px; }
  .cart-items .cart-item > td.cart-item__quantity .quantity__button svg,
  .cart-item__quantity .quantity__button svg { width: 16px; height: 16px; }
  /* 桌面端移除按钮 36 高，图标 18x18 */
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .button { width: 36px; height: 36px; }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .svg-wrapper { width: 18px; height: 18px; }
}

@media screen and (max-width: 749px) {
  /* 移动端数量与移除按钮统一 32x32；增减图标 16x16；移除图标 16x16 */
  .cart-items .cart-item > td.cart-item__quantity .quantity__button,
  .cart-item__quantity .quantity__button { width: 32px; height: 32px; min-width: 32px; min-height: 32px; }
  .cart-items .cart-item > td.cart-item__quantity .quantity__input,
  .cart-item__quantity .quantity__input { height: 32px; }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .button,
  cart-remove-button .button { width: 32px; height: 32px; min-width: 32px; min-height: 32px; }
  .cart-items .cart-item > td.cart-item__quantity .quantity__button svg,
  .cart-item__quantity .quantity__button svg { width: 16px; height: 16px; }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .svg-wrapper { width: 16px; height: 16px; }
}

@media screen and (max-width: 479px) {
  /* 超小屏保持与原型一致 */
  cart-remove-button .button { width: 32px; height: 32px; min-width: 32px; min-height: 32px; }
  cart-remove-button .svg-wrapper { width: 16px; height: 16px; }
}

/* 桌面端修复：确保删除图标可见（颜色、显示与填充） */
@media screen and (min-width: 750px) {
  /* 强制可见的文本颜色，供 SVG 使用 currentColor */
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .button,
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .button--tertiary { color: rgb(var(--color-foreground)) !important; background-color: transparent !important; }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .button:hover { color: rgb(var(--color-foreground)) !important; }

  /* 保证容器与 SVG 显示 */
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .svg-wrapper { display: inline-flex !important; color: rgb(var(--color-foreground)) !important; }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .svg-wrapper svg { display: block !important; color: rgb(var(--color-foreground)) !important; }

  /* 明确填充/描边为 currentColor，避免被其他 fill/stroke 覆盖 */
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .svg-wrapper svg,
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .svg-wrapper svg * { fill: currentColor !important; stroke: currentColor !important; }

  /* 直接针对 icon-remove 进一步兜底（某些全局 .icon 规则可能覆盖） */
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .icon.icon-remove { width: 16px; height: 16px; display: block; }
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .icon.icon-remove path,
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .icon.icon-remove rect,
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .icon.icon-remove circle,
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .icon.icon-remove line,
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .icon.icon-remove polyline,
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button .icon.icon-remove polygon { fill: currentColor !important; stroke: currentColor !important; }

  /* 禁止任何状态把删除按钮淡化或禁用（桌面端图标仍需可见） */
  .cart-items .cart-item > td.cart-item__quantity cart-remove-button { opacity: 1 !important; pointer-events: auto !important; }
}