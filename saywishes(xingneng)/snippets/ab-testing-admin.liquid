{% comment %}
  SayWishes A/B Testing Admin Interface Snippet
  ä¸“ä¸º wishesvideo.com å®šåˆ¶çš„ A/B æµ‹è¯•ç®¡ç†ç•Œé¢
  
  ä½¿ç”¨æ–¹æ³•:
  åœ¨éœ€è¦æ˜¾ç¤º A/B æµ‹è¯•ç®¡ç†ç•Œé¢çš„åœ°æ–¹æ·»åŠ :
  {% render 'ab-testing-admin' %}
  
  æ€§èƒ½ä¼˜åŒ–:
  - åªæœ‰åœ¨å¯ç”¨ A/B æµ‹è¯•æ—¶æ‰æ˜¾ç¤ºç®¡ç†ç•Œé¢
  - ä»…åœ¨ä¸»é¢˜ç¼–è¾‘å™¨ä¸­å¯è§ï¼Œä¸å½±å“å‰ç«¯æ€§èƒ½
{% endcomment %}

{% comment %} ä»…åœ¨å¯ç”¨ A/B æµ‹è¯•ä¸”åœ¨ä¸»é¢˜ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºç®¡ç†ç•Œé¢ {% endcomment %}
{% if settings.ab_test_enabled and request.design_mode %}
<div class="ab-testing-admin-panel" style="
  background: #f8f9fa;
  border: 2px solid #007cba;
  border-radius: 8px;
  padding: 20px;
  margin: 20px 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
">
  <div style="display: flex; align-items: center; margin-bottom: 15px;">
    <div style="
      width: 24px;
      height: 24px;
      background: #007cba;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      color: white;
      font-weight: bold;
      font-size: 14px;
    ">A/B</div>
    <h3 style="margin: 0; color: #007cba; font-size: 18px;">SayWishes A/B æµ‹è¯•ç®¡ç†</h3>
  </div>
  
  <div style="background: white; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
    <h4 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">ğŸ“Š æµ‹è¯•çŠ¶æ€</h4>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
      <div style="padding: 10px; background: #e8f5e8; border-radius: 4px; border-left: 4px solid #28a745;">
        <div style="font-weight: bold; color: #155724;">ç‰ˆæœ¬ A - æƒ…æ„Ÿè¥é”€</div>
        <div style="font-size: 14px; color: #155724; margin-top: 5px;">
          å¼ºè°ƒä¸ªæ€§åŒ–å’Œæƒ…æ„Ÿè¿æ¥<br>
          åŒ…å«é™æ—¶ä¼˜æƒ æ¨ªå¹…
        </div>
      </div>
      <div style="padding: 10px; background: #e3f2fd; border-radius: 4px; border-left: 4px solid #2196f3;">
        <div style="font-weight: bold; color: #0d47a1;">ç‰ˆæœ¬ B - ç†æ€§è¥é”€</div>
        <div style="font-size: 14px; color: #0d47a1; margin-top: 5px;">
          å¼ºè°ƒä¸“ä¸šæœåŠ¡å’Œå“è´¨ä¿è¯<br>
          åŒ…å«ä¸“ä¸šæœåŠ¡æ¨ªå¹…
        </div>
      </div>
    </div>
  </div>
  
  <div style="background: white; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
    <h4 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">âš™ï¸ æµ‹è¯•é…ç½®</h4>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
      <div><strong>æµ‹è¯•åç§°:</strong> saywishes_hero_ab_test</div>
      <div><strong>æµé‡åˆ†é…:</strong> 50% / 50%</div>
      <div><strong>æµ‹è¯•æŒç»­æ—¶é—´:</strong> {{ settings.ab_test_duration | default: 24 }} å°æ—¶</div>
      <div><strong>è°ƒè¯•æ¨¡å¼:</strong> {{ settings.ab_test_debug | default: false }}</div>
    </div>
  </div>
  
  <div style="background: white; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
    <h4 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">ğŸ“ˆ è·Ÿè¸ªäº‹ä»¶</h4>
    <div style="font-size: 14px; line-height: 1.6;">
      <div style="margin-bottom: 8px;">
        <strong>é¡µé¢äº‹ä»¶:</strong> é¡µé¢åŠ è½½ã€é¦–é¡µè®¿é—®ã€äº§å“é¡µè®¿é—®
      </div>
      <div style="margin-bottom: 8px;">
        <strong>è½¬åŒ–äº‹ä»¶:</strong> æ·»åŠ åˆ°è´­ç‰©è½¦ã€å¼€å§‹ç»“è´¦ã€è¡¨å•æäº¤
      </div>
      <div style="margin-bottom: 8px;">
        <strong>äº¤äº’äº‹ä»¶:</strong> æŒ‰é’®ç‚¹å‡»ã€åŒºåŸŸå¯è§æ€§
      </div>
    </div>
  </div>
  
  <div style="background: white; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
    <h4 style="margin: 0 0 10px 0; color: #333; font-size: 16px;">ğŸ”§ å¼€å‘å·¥å…·</h4>
    <div style="font-size: 14px; line-height: 1.6;">
      <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace;">
        <div><strong>æ§åˆ¶å°å‘½ä»¤:</strong></div>
        <div style="margin: 5px 0;">abTestDebug.getVersion() - è·å–å½“å‰ç‰ˆæœ¬</div>
        <div style="margin: 5px 0;">abTestDebug.setVersion('A') - å¼ºåˆ¶è®¾ç½®ç‰ˆæœ¬ A</div>
        <div style="margin: 5px 0;">abTestDebug.setVersion('B') - å¼ºåˆ¶è®¾ç½®ç‰ˆæœ¬ B</div>
        <div style="margin: 5px 0;">abTestDebug.reset() - é‡ç½®æµ‹è¯•</div>
        <div style="margin: 5px 0;">abTestDebug.showInfo() - æ˜¾ç¤ºæµ‹è¯•ä¿¡æ¯</div>
      </div>
    </div>
  </div>
  
  <div style="background: #fff3cd; padding: 15px; border-radius: 6px; border-left: 4px solid #ffc107;">
    <h4 style="margin: 0 0 10px 0; color: #856404; font-size: 16px;">âš ï¸ é‡è¦æç¤º</h4>
    <div style="font-size: 14px; color: #856404; line-height: 1.6;">
      <div style="margin-bottom: 8px;">
        â€¢ æ­¤ç®¡ç†é¢æ¿ä»…åœ¨ä¸»é¢˜ç¼–è¾‘å™¨ä¸­å¯è§ï¼Œè®¿å®¢æ— æ³•çœ‹åˆ°
      </div>
      <div style="margin-bottom: 8px;">
        â€¢ A/B æµ‹è¯•ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªè®¿å®¢åˆ†é…ç‰ˆæœ¬å¹¶ä¿å­˜ 24 å°æ—¶
      </div>
      <div style="margin-bottom: 8px;">
        â€¢ æ‰€æœ‰æµ‹è¯•æ•°æ®ä¼šå‘é€åˆ° Google Analytics å’Œ Facebook Pixel
      </div>
      <div style="margin-bottom: 8px;">
        â€¢ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¯·å…³é—­è°ƒè¯•æ¨¡å¼ä»¥æé«˜æ€§èƒ½
      </div>
    </div>
  </div>
  
  <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #dee2e6;">
    <div style="font-size: 12px; color: #6c757d;">
      SayWishes A/B Testing System v1.0 | ä¸“ä¸º wishesvideo.com å®šåˆ¶
    </div>
  </div>
</div>

{% comment %} åœ¨ä¸»é¢˜ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºå½“å‰ A/B æµ‹è¯•ç‰ˆæœ¬ {% endcomment %}
<script>
  if (window.Shopify && window.Shopify.designMode) {
    document.addEventListener('DOMContentLoaded', function() {
      // åˆ›å»ºç‰ˆæœ¬æŒ‡ç¤ºå™¨
      const indicator = document.createElement('div');
      indicator.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #007cba;
        color: white;
        padding: 10px 15px;
        border-radius: 20px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-size: 14px;
        font-weight: bold;
        z-index: 10000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        cursor: pointer;
      `;
      
      // æ£€æŸ¥å½“å‰ç‰ˆæœ¬
      if (window.sayWishesABTest) {
        const version = window.sayWishesABTest.getVersion();
        indicator.textContent = `A/B æµ‹è¯•: ç‰ˆæœ¬ ${version}`;
        indicator.style.background = version === 'A' ? '#ff6b6b' : '#4ecdc4';
        
        // ç‚¹å‡»åˆ‡æ¢ç‰ˆæœ¬
        indicator.addEventListener('click', function() {
          const newVersion = version === 'A' ? 'B' : 'A';
          if (window.abTestDebug) {
            window.abTestDebug.setVersion(newVersion);
          }
        });
      } else {
        indicator.textContent = 'A/B æµ‹è¯•: æœªåŠ è½½';
        indicator.style.background = '#dc3545';
      }
      
      document.body.appendChild(indicator);
    });
  }
</script>
{% endif %}

<script>
  // A/B Testing Admin Functions
  function updateAdminPanel() {
    const currentBucketEl = document.getElementById('current-bucket');
    const testNameEl = document.getElementById('test-name');
    const availableBucketsEl = document.getElementById('available-buckets');
    
    if (window.ABTest) {
      const bucket = window.ABTest.getCurrentBucket();
      currentBucketEl.textContent = bucket.toUpperCase();
      testNameEl.textContent = window.ABTest.testName;
      availableBucketsEl.textContent = window.ABTest.buckets.join(', ').toUpperCase();
    } else {
      currentBucketEl.textContent = 'Not initialized';
    }
  }

  function clearABTestData() {
    // Clear all A/B test cookies
    document.cookie = 'ab_test_bucket=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
    
    // Remove data attributes
    document.documentElement.removeAttribute('data-ab-bucket');
    document.documentElement.removeAttribute('data-ab-test');
    
    // Remove CSS classes
    document.body.classList.remove('ab-bucket-a', 'ab-bucket-b');
    
    alert('A/B test data cleared! Page will reload.');
    window.location.reload();
  }

  function toggleABDebug() {
    const url = new URL(window.location);
    if (url.searchParams.has('ab_debug')) {
      url.searchParams.delete('ab_debug');
    } else {
      url.searchParams.set('ab_debug', 'true');
    }
    window.location.href = url.toString();
  }

  // Handle bucket selector change
  document.addEventListener('DOMContentLoaded', function() {
    const bucketSelector = document.getElementById('bucket-selector');
    
    // Set current value
    const urlParams = new URLSearchParams(window.location.search);
    const forcedBucket = urlParams.get('ab_bucket');
    if (forcedBucket) {
      bucketSelector.value = forcedBucket;
    }
    
    bucketSelector.addEventListener('change', function() {
      const url = new URL(window.location);
      if (this.value) {
        url.searchParams.set('ab_bucket', this.value);
      } else {
        url.searchParams.delete('ab_bucket');
      }
      window.location.href = url.toString();
    });
    
    // Update panel when A/B test is ready
    window.addEventListener('ab-test-ready', updateAdminPanel);
    
    // Initial update
    setTimeout(updateAdminPanel, 100);
  });
</script>

<style>
  #ab-testing-admin button:hover {
    opacity: 0.8;
  }
  
  #ab-testing-admin select {
    border: 1px solid #ccc;
    border-radius: 4px;
  }
</style>

{% comment %} ä¸ºç”Ÿäº§ç¯å¢ƒæä¾›ç®€åŒ–çš„çŠ¶æ€æ˜¾ç¤º {% endcomment %}
{% unless request.design_mode %}
  {% if settings.ab_test_debug %}
    <div id="ab-test-debug-info" style="
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 12px;
      z-index: 9999;
    ">
      A/B æµ‹è¯•è°ƒè¯•æ¨¡å¼
    </div>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const debugInfo = document.getElementById('ab-test-debug-info');
        if (debugInfo && window.sayWishesABTest) {
          const version = window.sayWishesABTest.getVersion();
          debugInfo.textContent = `A/B æµ‹è¯•: ç‰ˆæœ¬ ${version}`;
          debugInfo.style.background = version === 'A' ? 'rgba(255,107,107,0.9)' : 'rgba(78,205,196,0.9)';
        }
      });
    </script>
  {% endif %}
{% endunless %}