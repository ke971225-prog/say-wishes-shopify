# 回滚操作手册（≤5分钟恢复）

目标：在出现异常或指标不达标时，快速恢复到优化前状态，不影响业务。

## 1. 版本控制基线
- 在部署前，请记录并填写基线 Git 提交：`<baseline_commit_hash>`。
- 推荐在优化完成后立即执行：
  - `git add .`
  - `git commit -m "perf: async CSS + hero LCP preload (6A compliant)"`
  - 记录新提交哈希：`<current_commit_hash>`。

## 2. A/B 测试与监控建议
- 将优化版作为实验组（例如：`theme-experiment`），原版作为对照组（`theme-control`）。
- 通过 GA4/热图工具、转化漏斗监控关键事件；设置异常报警（JS 错误率、站点可用性、LCP/CLS 越界等）。

## 3. 快速回滚方法

### 方法 A：Git 回滚（推荐）
- 回退到基线提交：
  - `git checkout <baseline_commit_hash>`
  - 或回滚指定文件：
    - `git checkout <baseline_commit_hash> -- layout/theme.liquid`
    - `git checkout <baseline_commit_hash> -- sections/hero-section.liquid`
- 回滚后重新部署主题。

### 方法 B：PowerShell 快速替换脚本
- 适用于没有 Git 或需要立即覆盖恢复的场景。
- 使用 `rollback.ps1` 自动恢复关键片段（见同目录脚本）。
- 执行方式（以管理员或有权限用户运行）：
  - 在 PowerShell 中执行：
    - `Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass`
    - `& "d:\独立站\网站网速\性能\交付物\rollback.ps1"`

说明：脚本将恢复 `layout/theme.liquid` 的异步 CSS 片段为 `stylesheet_tag` 原始模式，并将 `sections/hero-section.liquid` 中的预加载段落还原为隐藏占位 `<img>` 模式（不影响背景绘制）。

## 4. 恢复后验证清单
- 页面可用性：无 500/JS fatal 错误；菜单与购物车可用。
- 可访问性：键盘导航与语义不变；图像 ALT、可见文本保持。
- 指标检查：LCP/CLS/TBT/INP 回到优化前水平；无异常报警。
- 功能完整性：A/B、GA4、埋点与转化路径正常。

## 5. 风险与注意事项
- 若在高流量时段回滚，请采用 A/B 按比例放量，避免用户体验抖动。
- 回滚后请在 24 小时内完成基线对比报告归档。